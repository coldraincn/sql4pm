# 函数与表达式  

## 1. 部分函数  

>函数用于计数和计算，我们在[聚合查询](./聚合查询.md)中学过`sum`,`count`等函数  

### 算数函数  

1. abs()绝对值  

    有时候用户订单下多了，我们的库存可能为负数，插入一条数据`insert into box (name,color,stock,factory_id) values ('低端盒子','黑',-5,4);`,库存为-5。然后我们查询出这条字段`select name,stock from box where id = 15;`,(id根据自己数据库实际信息填写)  

    ```bash
    mysql> select name,stock from box where id = 15;
    +--------------+-------+
    | name         | stock |
    +--------------+-------+
    | 低端盒子     |    -5 |
    +--------------+-------+
    1 row in set (0.00 sec)
    ```  

    然后我们使用abs函数`select name,abs(stock) from box where id = 15;`  

    ```bash
    mysql> select name,abs(stock) from box where id = 15;
    +--------------+------------+
    | name         | abs(stock) |
    +--------------+------------+
    | 低端盒子     |          5 |
    +--------------+------------+
    1 row in set (0.00 sec)
    ```  

2. round()四舍五入  

    当有小数的时候可以使用round函数四舍五入成整数

### 日期函数（mysql，其他数据库可能不一样）  

1. NOW()，获取当前日期时间  

    使用语句`select name, color,now() from box;`：  

    ```bash
    mysql> select name, color,now() from box;
    +--------------+-------+---------------------+
    | name         | color | now()               |
    +--------------+-------+---------------------+
    | 终端盒子     | 紫    | 2019-05-10 12:26:48 |
    | 高端盒子     | 蓝    | 2019-05-10 12:26:48 |
    | 中端盒子     | 红    | 2019-05-10 12:26:48 |
    | NULL         | 红    | 2019-05-10 12:26:48 |
    | 中端盒子     | 红    | 2019-05-10 12:26:48 |
    | 高端盒子     | 红    | 2019-05-10 12:26:48 |
    | 高端盒子     | 红    | 2019-05-10 12:26:48 |
    | 低端盒子     | 黑    | 2019-05-10 12:26:48 |
    +--------------+-------+---------------------+
    8 rows in set (0.00 sec)
    ```  

    当插入数据的时候可以使用now函数插入当前时间。  

2. CURDATE()获取当前的日期  

    如果只想插入日期的话，例如2019-10-10，可以使用这个函数  

3. CURTIME()获取当前时间  

    如果只想插入例如，12:34:54这种时间，可以使用这个函数  

其他函数可以查询不同数据库说明文档  

## 表达式(case when)  

>这个语句可以用来根据不同的条件来区分。有两种方式：
>```sql
>--简单case函数
>case sex
>  when '1' then '男'
>  when '2' then '女’
>  else '其他' end
>--case搜索函数
>case when sex = '1' then '男'
>     when sex = '2' then '女'
>     else '其他' end 
>```  

比如我们可以在查询库存的时候根据不同值显示不同描述，库存大于10显示充足，库存小于0显示紧急，其他显示不足。`select id,name,color,stock,(case  when stock>10 then "充足" when stock<0 then "紧急" else "不足" end) as 库存描述 from box;`  

```sql
mysql> select id,name,color,stock,(case  when stock>10 then "充足" when stock<0 then "紧急" else "不足" end) as 库存描述 from box;
+----+--------------+-------+-------+--------------+
| id | name         | color | stock | 库存描述     |
+----+--------------+-------+-------+--------------+
|  1 | 终端盒子     | 紫    |     2 | 不足         |
|  2 | 高端盒子     | 蓝    |    12 | 充足         |
|  3 | 中端盒子     | 红    |     3 | 不足         |
|  4 | NULL         | 红    |    44 | 充足         |
|  5 | 中端盒子     | 红    |     2 | 不足         |
|  6 | 高端盒子     | 红    |     0 | 不足         |
|  7 | 高端盒子     | 红    |    67 | 充足         |
| 15 | 低端盒子     | 黑    |    -5 | 紧急         |
+----+--------------+-------+-------+--------------+
8 rows in set (0.00 sec)
```  

这语句也可以用到where，聚合函数中。
