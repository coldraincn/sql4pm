# 多表查询

## 1. 简单多表查询

### 乘积（笛卡尔积）  

我们使用`select * from box,factory;`  

```bash
mysql> select * from box,factory;
+----+--------------+-------+-------+----+---------------+---------------------+
| id | name         | color | stock | id | name          | build_time          |
+----+--------------+-------+-------+----+---------------+---------------------+
|  1 | 终端盒子     | 紫    |     2 |  1 | 盒子工厂1     | 2010-04-05 12:30:32 |
|  2 | 高端盒子     | 蓝    |    12 |  1 | 盒子工厂1     | 2010-04-05 12:30:32 |
|  3 | 中端盒子     | 红    |     3 |  1 | 盒子工厂1     | 2010-04-05 12:30:32 |
|  4 | NULL         | 红    |    44 |  1 | 盒子工厂1     | 2010-04-05 12:30:32 |
|  5 | 中端盒子     | 红    |     2 |  1 | 盒子工厂1     | 2010-04-05 12:30:32 |
|  6 | 高端盒子     | 红    |     0 |  1 | 盒子工厂1     | 2010-04-05 12:30:32 |
|  7 | 高端盒子     | 红    |    67 |  1 | 盒子工厂1     | 2010-04-05 12:30:32 |
|  1 | 终端盒子     | 紫    |     2 |  2 | 盒子工厂2     | 2010-04-06 12:30:32 |
|  2 | 高端盒子     | 蓝    |    12 |  2 | 盒子工厂2     | 2010-04-06 12:30:32 |
|  3 | 中端盒子     | 红    |     3 |  2 | 盒子工厂2     | 2010-04-06 12:30:32 |
|  4 | NULL         | 红    |    44 |  2 | 盒子工厂2     | 2010-04-06 12:30:32 |
|  5 | 中端盒子     | 红    |     2 |  2 | 盒子工厂2     | 2010-04-06 12:30:32 |
|  6 | 高端盒子     | 红    |     0 |  2 | 盒子工厂2     | 2010-04-06 12:30:32 |
|  7 | 高端盒子     | 红    |    67 |  2 | 盒子工厂2     | 2010-04-06 12:30:32 |
|  1 | 终端盒子     | 紫    |     2 |  3 | 盒子工厂3     | 2011-04-05 12:30:32 |
|  2 | 高端盒子     | 蓝    |    12 |  3 | 盒子工厂3     | 2011-04-05 12:30:32 |
|  3 | 中端盒子     | 红    |     3 |  3 | 盒子工厂3     | 2011-04-05 12:30:32 |
|  4 | NULL         | 红    |    44 |  3 | 盒子工厂3     | 2011-04-05 12:30:32 |
|  5 | 中端盒子     | 红    |     2 |  3 | 盒子工厂3     | 2011-04-05 12:30:32 |
|  6 | 高端盒子     | 红    |     0 |  3 | 盒子工厂3     | 2011-04-05 12:30:32 |
|  7 | 高端盒子     | 红    |    67 |  3 | 盒子工厂3     | 2011-04-05 12:30:32 |
|  1 | 终端盒子     | 紫    |     2 |  4 | 盒子工厂4     | 2009-04-05 12:30:32 |
|  2 | 高端盒子     | 蓝    |    12 |  4 | 盒子工厂4     | 2009-04-05 12:30:32 |
|  3 | 中端盒子     | 红    |     3 |  4 | 盒子工厂4     | 2009-04-05 12:30:32 |
|  4 | NULL         | 红    |    44 |  4 | 盒子工厂4     | 2009-04-05 12:30:32 |
|  5 | 中端盒子     | 红    |     2 |  4 | 盒子工厂4     | 2009-04-05 12:30:32 |
|  6 | 高端盒子     | 红    |     0 |  4 | 盒子工厂4     | 2009-04-05 12:30:32 |
|  7 | 高端盒子     | 红    |    67 |  4 | 盒子工厂4     | 2009-04-05 12:30:32 |
|  1 | 终端盒子     | 紫    |     2 |  5 | 盒子工厂5     | 2003-04-05 12:30:32 |
|  2 | 高端盒子     | 蓝    |    12 |  5 | 盒子工厂5     | 2003-04-05 12:30:32 |
|  3 | 中端盒子     | 红    |     3 |  5 | 盒子工厂5     | 2003-04-05 12:30:32 |
|  4 | NULL         | 红    |    44 |  5 | 盒子工厂5     | 2003-04-05 12:30:32 |
|  5 | 中端盒子     | 红    |     2 |  5 | 盒子工厂5     | 2003-04-05 12:30:32 |
|  6 | 高端盒子     | 红    |     0 |  5 | 盒子工厂5     | 2003-04-05 12:30:32 |
|  7 | 高端盒子     | 红    |    67 |  5 | 盒子工厂5     | 2003-04-05 12:30:32 |
|  1 | 终端盒子     | 紫    |     2 |  6 | 盒子工厂6     | 2010-05-05 12:30:32 |
|  2 | 高端盒子     | 蓝    |    12 |  6 | 盒子工厂6     | 2010-05-05 12:30:32 |
|  3 | 中端盒子     | 红    |     3 |  6 | 盒子工厂6     | 2010-05-05 12:30:32 |
|  4 | NULL         | 红    |    44 |  6 | 盒子工厂6     | 2010-05-05 12:30:32 |
|  5 | 中端盒子     | 红    |     2 |  6 | 盒子工厂6     | 2010-05-05 12:30:32 |
|  6 | 高端盒子     | 红    |     0 |  6 | 盒子工厂6     | 2010-05-05 12:30:32 |
|  7 | 高端盒子     | 红    |    67 |  6 | 盒子工厂6     | 2010-05-05 12:30:32 |
|  1 | 终端盒子     | 紫    |     2 |  7 | 盒子工厂7     | 2018-04-05 12:30:32 |
|  2 | 高端盒子     | 蓝    |    12 |  7 | 盒子工厂7     | 2018-04-05 12:30:32 |
|  3 | 中端盒子     | 红    |     3 |  7 | 盒子工厂7     | 2018-04-05 12:30:32 |
|  4 | NULL         | 红    |    44 |  7 | 盒子工厂7     | 2018-04-05 12:30:32 |
|  5 | 中端盒子     | 红    |     2 |  7 | 盒子工厂7     | 2018-04-05 12:30:32 |
|  6 | 高端盒子     | 红    |     0 |  7 | 盒子工厂7     | 2018-04-05 12:30:32 |
|  7 | 高端盒子     | 红    |    67 |  7 | 盒子工厂7     | 2018-04-05 12:30:32 |
|  1 | 终端盒子     | 紫    |     2 |  8 | 盒子工厂8     | 2010-08-05 12:30:32 |
|  2 | 高端盒子     | 蓝    |    12 |  8 | 盒子工厂8     | 2010-08-05 12:30:32 |
|  3 | 中端盒子     | 红    |     3 |  8 | 盒子工厂8     | 2010-08-05 12:30:32 |
|  4 | NULL         | 红    |    44 |  8 | 盒子工厂8     | 2010-08-05 12:30:32 |
|  5 | 中端盒子     | 红    |     2 |  8 | 盒子工厂8     | 2010-08-05 12:30:32 |
|  6 | 高端盒子     | 红    |     0 |  8 | 盒子工厂8     | 2010-08-05 12:30:32 |
|  7 | 高端盒子     | 红    |    67 |  8 | 盒子工厂8     | 2010-08-05 12:30:32 |
+----+--------------+-------+-------+----+---------------+---------------------+
56 rows in set (0.00 sec)

```  

可以看到最后的结果有56行，我们分别查下两个表`select * from box;`,`select * from factory;`  

```bash
mysql> select * from box;
+----+--------------+-------+-------+
| id | name         | color | stock |
+----+--------------+-------+-------+
|  1 | 终端盒子     | 紫    |     2 |
|  2 | 高端盒子     | 蓝    |    12 |
|  3 | 中端盒子     | 红    |     3 |
|  4 | NULL         | 红    |    44 |
|  5 | 中端盒子     | 红    |     2 |
|  6 | 高端盒子     | 红    |     0 |
|  7 | 高端盒子     | 红    |    67 |
+----+--------------+-------+-------+
7 rows in set (0.00 sec)
```  

```bash
mysql> select * from factory;
+----+---------------+---------------------+
| id | name          | build_time          |
+----+---------------+---------------------+
|  1 | 盒子工厂1     | 2010-04-05 12:30:32 |
|  2 | 盒子工厂2     | 2010-04-06 12:30:32 |
|  3 | 盒子工厂3     | 2011-04-05 12:30:32 |
|  4 | 盒子工厂4     | 2009-04-05 12:30:32 |
|  5 | 盒子工厂5     | 2003-04-05 12:30:32 |
|  6 | 盒子工厂6     | 2010-05-05 12:30:32 |
|  7 | 盒子工厂7     | 2018-04-05 12:30:32 |
|  8 | 盒子工厂8     | 2010-08-05 12:30:32 |
+----+---------------+---------------------+
8 rows in set (0.00 sec)
```

可以看到box中有7条数据，factory表中有8条数据，我们同时查询两个表的时候有7*8=56条数据，这种一次查询两个表，表示的是两个表的乘积（笛卡尔积），box中的每一行与factory中的每一行亮亮组合在一起的结果。  

### 别名+条件选择  

我们使用乘积查询两个表的时候，发现有两个id，两个name字段，我们可以使用别名，而且可以使用条件筛选，比如我们可以选择box的id等于factory的id的结果`select b.id as bid,b.name as bname,b.color,b.stock,f.id as fid,f.name as fname from box as b,factory as f where b.id=f.id;`  

```sql
select b.id as bid,
b.name as bname,
b.color,
b.stock,
f.id as fid,
f.name as fname from box as b,factory as f where b.id=f.id;
```  

```bash
mysql> select b.id as bid,b.name as bname,b.color,b.stock,f.id as fid,f.name as fname from box as b,factory as f where b.id=f.id;
+-----+--------------+-------+-------+-----+---------------+
| bid | bname        | color | stock | fid | fname         |
+-----+--------------+-------+-------+-----+---------------+
|   1 | 终端盒子     | 紫    |     2 |   1 | 盒子工厂1     |
|   2 | 高端盒子     | 蓝    |    12 |   2 | 盒子工厂2     |
|   3 | 中端盒子     | 红    |     3 |   3 | 盒子工厂3     |
|   4 | NULL         | 红    |    44 |   4 | 盒子工厂4     |
|   5 | 中端盒子     | 红    |     2 |   5 | 盒子工厂5     |
|   6 | 高端盒子     | 红    |     0 |   6 | 盒子工厂6     |
|   7 | 高端盒子     | 红    |    67 |   7 | 盒子工厂7     |
+-----+--------------+-------+-------+-----+---------------+
7 rows in set (0.01 sec)
```  

## 2. 连接查询

预备处理，我们知道盒子是由工厂制造的，现在我们的box表只有id，盒子名称(name)，盒子颜色(color)，库存(stock)信息，为了知道盒子由哪个工厂制造，我们可以在box表中添加工厂名，如果再需要知道工厂的时间，可以加上工厂建造时间。但我们在[基本语法与建库建表](./基本语法与建库建表.md)中关系**数据库模型**学到的，盒子与工厂是多对一的关系，我们可以在盒子box表中加入工厂id，factory_id。使用workbench或者输入sql语句`alter table box add column factory_id int;`，插入一些数据:  

```sql
UPDATE box SET factory_id = 1 WHERE id = 1;
UPDATE box SET factory_id = 1 WHERE id = 2;
UPDATE box SET factory_id = 6 WHERE id = 3;
UPDATE box SET factory_id = 3 WHERE id = 4;
UPDATE box SET factory_id = 2 WHERE id = 5;
UPDATE box SET factory_id = 3 WHERE id = 6;
UPDATE box SET factory_id = 9 WHERE id = 7;
```  

查看数据库，`select * from box;`  

```bash
mysql> select * from box;
+----+--------------+-------+-------+------------+
| id | name         | color | stock | factory_id |
+----+--------------+-------+-------+------------+
|  1 | 终端盒子     | 紫    |     2 |          1 |
|  2 | 高端盒子     | 蓝    |    12 |          1 |
|  3 | 中端盒子     | 红    |     3 |          6 |
|  4 | NULL         | 红    |    44 |          3 |
|  5 | 中端盒子     | 红    |     2 |          2 |
|  6 | 高端盒子     | 红    |     0 |          3 |
|  7 | 高端盒子     | 红    |    67 |          9 |
+----+--------------+-------+-------+------------+
7 rows in set (0.00 sec)
```  

## left join

我们要查询所有的盒子，并且将该盒子的生产工厂id以及名展示出来，我们可以使用语句:  

```sql
select b.id,b.name,b.color,b.stock,b.factory_id,f.name as fname 
from box as b
left join factory as f 
on b.factory_id=f.id;
```  

```bash
mysql> select b.id,b.name,b.color,b.stock,b.factory_id,f.name as fname  from box as b left join factory as f  on b.factory_id=f.id;
+----+--------------+-------+-------+------------+---------------+
| id | name         | color | stock | factory_id | fname         |
+----+--------------+-------+-------+------------+---------------+
|  1 | 终端盒子     | 紫    |     2 |          1 | 盒子工厂1     |
|  2 | 高端盒子     | 蓝    |    12 |          1 | 盒子工厂1     |
|  3 | 中端盒子     | 红    |     3 |          6 | 盒子工厂6     |
|  4 | NULL         | 红    |    44 |          3 | 盒子工厂3     |
|  5 | 中端盒子     | 红    |     2 |          2 | 盒子工厂2     |
|  6 | 高端盒子     | 红    |     0 |          3 | 盒子工厂3     |
|  7 | 高端盒子     | 红    |    67 |          9 | NULL          |
+----+--------------+-------+-------+------------+---------------+
7 rows in set (0.00 sec)
```  

我们可以看到所有的盒子都展示出来了，而且最后的fname一列展示了生产该盒子的名字。on关键词类似与where条件，表示box表的factory_id等于factory表的id，需要连接在一起。left jion表示需要连接的表，在这里表示需要连接factory。  

### inner join  

如果我们把left join换成inner join会怎样？  

```sql
select b.id,b.name,b.color,b.stock,b.factory_id,f.name as fname 
from box as b
inner join factory as f 
on b.factory_id=f.id;
```  

```bash
mysql> select b.id,b.name,b.color,b.stock,b.factory_id,f.name as fname
    -> from box as b
    -> inner join factory as f
    -> on b.factory_id=f.id;
+----+--------------+-------+-------+------------+---------------+
| id | name         | color | stock | factory_id | fname         |
+----+--------------+-------+-------+------------+---------------+
|  1 | 终端盒子     | 紫    |     2 |          1 | 盒子工厂1     |
|  2 | 高端盒子     | 蓝    |    12 |          1 | 盒子工厂1     |
|  3 | 中端盒子     | 红    |     3 |          6 | 盒子工厂6     |
|  4 | NULL         | 红    |    44 |          3 | 盒子工厂3     |
|  5 | 中端盒子     | 红    |     2 |          2 | 盒子工厂2     |
|  6 | 高端盒子     | 红    |     0 |          3 | 盒子工厂3     |
+----+--------------+-------+-------+------------+---------------+
6 rows in set (0.00 sec)
```  

然后我们发现inner 和left join结果的区别是，在left join中id为7的盒子生产工厂id是8，factory表中没有这个工厂，显示的是null。而在inner join中，id为7的盒子这一行并没有显示。

### inner join,left join,right join,full join

连接有这四种，那么有什么区别呢
